import _ from"https://cdn.jsdelivr.net/npm/a11y-dialog@8/dist/a11y-dialog.esm.min.js";function m(s,e){const t=r(s,e);return window.location.href.replace(/\?image=*/,`?image=${t}`)}function p(s,e){const t=o(s,e);return window.location.href.replace(/\?image=*/,`?image=${t}`)}function r(s,e){let t=s;return s-1<0?t=e-1:t=s-1,t}function o(s,e){let t=s;return s+1>e-1?t=0:t=s+1,t}function g(s,e){const t=[r(s,e.length),o(s,e.length)];h(e[s]);for(const i of t)h(e[i])}function h(s){s.loading="eager"}class L{constructor(e){if(this.dialog=null,this.carouselElem=null,this.slidesUl=null,this.imagesElements=[],this.prevLink=null,this.nextLink=null,this.closeButton=null,this.currentIdx=null,this.isOpen=!1,this._popstateHandler=n=>{},this._keydownHandler=n=>{},this._hoverPrevHandler=n=>{},this._hoverNextHandler=n=>{},this._goToPrevHandler=n=>{},this._goToNextHandler=n=>{},this._closeHandler=n=>{},this._updateSlideHandler=n=>{},e==null)return;const t=e.querySelector("#slides"),i=e.querySelector("#prevLink"),l=e.querySelector("#nextLink"),a=e.querySelector("#closeButton");if(t==null||i==null||l==null||a==null)return;this.dialog=new _(document.getElementById("carousel-dialog")),this.carouselElem=e,this.slidesUl=t,this.prevLink=i,this.nextLink=l,this.closeButton=a;const{currentIndex:c,isOpen:u}=this._getCarouselState();this.currentIdx=c,this.isOpen=u,this.slidesUl.children[this.currentIdx]?.classList.add("carousel__slide--visible"),this.imagesElements=Array.from(this.slidesUl.children).reduce((n,v)=>{const d=v.querySelector("picture img");return d instanceof HTMLImageElement&&n.push(d),n},[]),this.isOpen&&this.open(this.currentIdx),this._popstateHandler=this._handlePopstate.bind(this),addEventListener("popstate",this._popstateHandler)}open(e=void 0){e==null||Number.isNaN(e)||(document.documentElement.style.overflow="hidden",this.carouselElem.classList.add("carousel--active"),this.isOpen=!0,this._addEvents(),this._updateCarouselUrl(e),this.dialog.show())}close(){document.documentElement.style.overflow="auto",this.carouselElem.classList.remove("carousel--active"),this.isOpen=!1,this._updateCarouselUrl(),this._removeEvents(),this.dialog.hide()}_changeCurrentSlide(e,t){if(t>this.slidesUl.childElementCount){this.close();return}this.slidesUl.children[t]?.classList.add("carousel__slide--visible"),t!==e&&this.slidesUl.children[e]?.classList.remove("carousel__slide--visible"),this.currentIdx=t,this.isOpen&&g(this.currentIdx,this.imagesElements),this.prevLink.href=m(this.currentIdx,this.slidesUl.childElementCount),this.nextLink.href=p(this.currentIdx,this.slidesUl.childElementCount)}_addEvents(){this._keydownHandler=this._handleKeydown.bind(this),this._hoverPrevHandler=this._hoverPrev.bind(this),this._hoverNextHandler=this._hoverNext.bind(this),this._goToPrevHandler=this._handleGoToPrev.bind(this),this._goToNextHandler=this._handleGoToNext.bind(this),this._closeHandler=this._handleClose.bind(this),this._updateSlideHandler=this._handleUpdateSlide.bind(this),this.dialog.on("hide",this._closeHandler),this.prevLink.addEventListener("click",this._goToPrevHandler),this.prevLink.addEventListener("mouserenter",this._hoverPrev),this.nextLink.addEventListener("click",this._goToNextHandler),this.nextLink.addEventListener("mouserenter",this._hoverNext),this.closeButton.addEventListener("click",this._closeHandler),document.addEventListener("keydown",this._keydownHandler)}_removeEvents(){this.prevLink.removeEventListener("click",this._goToPrevHandler),this.prevLink.removeEventListener("mouserenter",this._hoverPrev),this.nextLink.removeEventListener("click",this._goToNextHandler),this.nextLink.removeEventListener("mouserenter",this._hoverNext),this.closeButton.removeEventListener("click",this._closeHandler),document.removeEventListener("keydown",this._keydownHandler),this.dialog.off("hide",this._closeHandler)}_handlePopstate(e){e.state?.imageIndex==null?this.isOpen&&this.close():this.isOpen?this._changeCurrentSlide(this.currentIdx,e.state?.imageIndex):this.open(e.state.imageIndex)}_handleKeydown(e){e.key=="ArrowLeft"&&this._handleGoToPrev(e),e.key=="ArrowRight"&&this._handleGoToNext(e),e.key=="Escape"&&this._handleClose(e)}_hoverPrev(e){const t=r(this.currentIdx,this.slidesUl?.childElementCount??0);h(this.imagesElements[t])}_hoverNext(e){const t=o(this.currentIdx,this.slidesUl?.childElementCount??0);h(this.imagesElements[t])}_handleGoToPrev(e){e.preventDefault();const t=r(this.currentIdx,this.slidesUl?.childElementCount??0);this._updateCarouselUrl(t)}_handleGoToNext(e){e.preventDefault();const t=o(this.currentIdx,this.slidesUl?.childElementCount??0);this._updateCarouselUrl(t)}_handleClose(e){this.close()}_handleUpdateSlide(e){const{currentIndex:t,isOpen:i}=this._getCarouselState();i&&this._changeCurrentSlide(this.currentIdx,t)}_getCarouselState(){const e=new URLSearchParams(window.location.search),t=Object.fromEntries(e.entries()),i=Number(t.image??0),l=!!t.image;return{currentIndex:i,isOpen:l}}_updateCarouselUrl(e=void 0){const t=new URL(window.location.href);e==null?(t.searchParams.delete("image"),history.state?.imageIndex==null?history.replaceState(null,"",t):history.pushState(null,"",t)):(t.searchParams.set("image",String(e)),history.state?.imageIndex==null?history.pushState({imageIndex:e},"",t):history.replaceState({imageIndex:e},"",t)),this._changeCurrentSlide(this.currentIdx,e)}}class f extends HTMLElement{constructor(){super(),this.carouselTargetList=null}connectedCallback(){const e=this.querySelector("#carousel");this.carousel=new L(e),this.carouselTargetList=document.getElementById("carouselTargetList"),this._openHandler=this._handleOpen.bind(this),this.carouselTargetList?.addEventListener("click",this._openHandler),this.carouselTargetList?.addEventListener("keydown",this._openHandler)}disconnectedCallback(){this.carouselTargetList?.removeEventListener("click",this._openHandler),this.carouselTargetList?.removeEventListener("keydown",this._openHandler),this.carousel.close()}_handleOpen(e){if(e.target instanceof HTMLElement){const t=e.target.closest("[data-carousel-index]")?.dataset.carouselIndex;if(e instanceof KeyboardEvent&&e.key!=="Enter")return;e.preventDefault();const i=Number(t);this.carousel.open(i)}}}customElements.define("carousel-wrapper",f);
